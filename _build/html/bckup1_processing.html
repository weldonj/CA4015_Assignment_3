
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Data Preprocessing &#8212; CA4015 Assignment 2 - Time Series Classification - Jack Boylan, Daniel O&#39;Boyle, John Weldon</title>
    
  <link rel="stylesheet" href="_static/css/index.73d71520a4ca3b99cfee5594769eaaae.css">

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      
  <link rel="stylesheet"
    href="_static/vendor/open-sans_all/1.44.1/index.css">
  <link rel="stylesheet"
    href="_static/vendor/lato_latin-ext/1.44.1/index.css">

    
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/sphinx-book-theme.40e2e510f6b7d1648584402491bb10fe.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="_static/js/index.3da636dd464baa7582d2.js">

    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/language_data.js"></script>
    <script src="_static/togglebutton.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="_static/sphinx-book-theme.d31b09fe5c1d09cb49b26a786de4a05d.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />



  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="index.html">
  
  <img src="_static/classification.png" class="logo" alt="logo">
  
  
  <h1 class="site-logo" id="site-title">CA4015 Assignment 2 - Time Series Classification - Jack Boylan, Daniel O'Boyle, John Weldon</h1>
  
</a>
</div><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form>
<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
    <ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="Intro_and_Desc_of_Data.html">
   INTRODUCTION AND DESCRIPTION OF DATASET
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  Data Cleaning and Processing
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="processing.html">
   Data Preprocessing
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="processing.html#data-processing">
   Data Processing
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  Classification Model
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="classification.html">
   <strong>
    Classification of windowed time series without feature extraction
   </strong>
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="classification.html#sklearn-binary-data-classifier">
   Sklearn - Binary Data Classifier
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="classification.html#sklearn-three-label-data-classifier">
   Sklearn - Three-Label Data Classifier
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="classification.html#sklearn-multi-label-data-classifier">
   Sklearn - Multi-Label Data Classifier
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="classification.html#classification-of-windowed-time-series-data-with-extracted-features">
   <strong>
    Classification of Windowed Time Series Data with Extracted features
   </strong>
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="classification.html#pca-of-extracted-features">
   PCA of Extracted Features
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="classification.html#binary-data-classifier">
   Binary Data Classifier
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="classification.html#three-label-classifier">
   Three-Label Classifier
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="classification.html#multi-label-classifier">
   Multi-Label Classifier
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  Concluding Section
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="Summary_Conclusion.html">
   Summary and Learning Outcomes
  </a>
 </li>
</ul>

</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="row topbar fixed-top container-xl">
    <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show">
    </div>
    <div class="col pl-2 topbar-main">
        
        <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
            data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
            aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
            title="Toggle navigation" data-toggle="tooltip" data-placement="left">
            <i class="fas fa-bars"></i>
            <i class="fas fa-arrow-left"></i>
            <i class="fas fa-arrow-up"></i>
        </button>
        
        
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="_sources/bckup1_processing.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

        <!-- Source interaction buttons -->


        <!-- Full screen (wrap in <a> to have style consistency -->
        <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
                data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
                title="Fullscreen mode"><i
                    class="fas fa-expand"></i></button></a>

        <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/executablebooks/jupyter-book/master?urlpath=tree/bckup1_processing.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

    </div>

    <!-- Table of contents -->
    <div class="d-none d-md-block col-md-2 bd-toc show">
        
        <div class="tocsection onthispage pt-5 pb-3">
            <i class="fas fa-list"></i> Contents
        </div>
        <nav id="bd-toc-nav">
            <ul class="nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   Data Preprocessing
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#mount-drive">
     Mount Drive
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#load-a-sample-of-data">
     Load a sample of data
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#plot-the-sample-data">
     Plot the sample data
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#load-a-sample-of-labels">
     Load a sample of Labels
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#tip">
     Tip:
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#data-processing">
   Data Processing
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#processing-the-data-so-we-can-use-tsfresh-to-extract-the-time-series-features">
     Processing the data so we can use tsfresh to extract the time series features
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#label-4">
     Label “4”?
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#extracting-features">
     Extracting features
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#prep-the-dataset-for-tsfresh-package">
       Prep the dataset for tsfresh package
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
</ul>

        </nav>
        
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="data-preprocessing">
<h1>Data Preprocessing<a class="headerlink" href="#data-preprocessing" title="Permalink to this headline">¶</a></h1>
<div class="section" id="mount-drive">
<h2>Mount Drive<a class="headerlink" href="#mount-drive" title="Permalink to this headline">¶</a></h2>
<p>This is just where we load the data in colabs, this step may not be necessary depending on who is running it and what IDE they use</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">google.colab</span> <span class="kn">import</span> <span class="n">drive</span>
<span class="n">drive</span><span class="o">.</span><span class="n">mount</span><span class="p">(</span><span class="s1">&#39;/content/drive&#39;</span><span class="p">)</span>

<span class="c1"># You may have a different directory you want to change to...</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="s1">&#39;/content/drive/My Drive/CA4015/sleep_classify&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Drive already mounted at /content/drive; to attempt to forcibly remount, call drive.mount(&quot;/content/drive&quot;, force_remount=True).
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="load-a-sample-of-data">
<h2>Load a sample of data<a class="headerlink" href="#load-a-sample-of-data" title="Permalink to this headline">¶</a></h2>
<p>Next we show an example of how to load the raw data and the preprocessed ‘cropped’ data. You can use either data, we would recommend the processed data as it’s cleaner:</p>
<p>– In cases where the battery on the Apple Watch failed before the sleep opportunity ended, the data was cropped to include only those time points for which valid data existed.</p>
<p>The preprocessed/cropped data was taken from <code class="docutils literal notranslate"><span class="pre">preprocessing_runner.py</span></code> as recommended from the authors of the data collection experiment <a class="reference external" href="https://github.com/ojwalch/sleep_classifiers/tree/f8010da19efbb52924f8723f37854c33eafacc4c">here</a>.</p>
<p>The processed data can be found in <code class="docutils literal notranslate"><span class="pre">./outputs/cropped/</span></code> folder.</p>
<ul class="simple">
<li><p>We recommend to use this folder as the feature vector or ‘X’ data and the files in <code class="docutils literal notranslate"><span class="pre">./data/labels/</span></code> as the target vector or ‘y’ data.</p></li>
<li><p>You can/should perform some further feature engineering on the ‘X’ data.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="n">x_clean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="s1">&#39;./outputs/cropped/46343_cleaned_motion.out&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">x_clean</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

<span class="n">x_raw</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="s1">&#39;./data/motion/46343_acceleration.txt&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">x_raw</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(850024, 4)
(982000, 4)
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="plot-the-sample-data">
<h2>Plot the sample data<a class="headerlink" href="#plot-the-sample-data" title="Permalink to this headline">¶</a></h2>
<p>In the raw data set we can see activity on left and right, but it looks like the watch must have died in between</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">sampfrom</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">sampto</span> <span class="o">=</span> <span class="mi">85000</span> <span class="c1"># Pick any value</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_clean</span><span class="p">[</span><span class="n">sampfrom</span><span class="p">:</span><span class="n">sampto</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="n">x_clean</span><span class="p">[</span><span class="n">sampfrom</span><span class="p">:</span><span class="n">sampto</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_clean</span><span class="p">[</span><span class="n">sampfrom</span><span class="p">:</span><span class="n">sampto</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="n">x_clean</span><span class="p">[</span><span class="n">sampfrom</span><span class="p">:</span><span class="n">sampto</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_clean</span><span class="p">[</span><span class="n">sampfrom</span><span class="p">:</span><span class="n">sampto</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="n">x_clean</span><span class="p">[</span><span class="n">sampfrom</span><span class="p">:</span><span class="n">sampto</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;z&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Filtered Movement Data&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_raw</span><span class="p">[</span><span class="n">sampfrom</span><span class="p">:</span><span class="n">sampto</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="n">x_raw</span><span class="p">[</span><span class="n">sampfrom</span><span class="p">:</span><span class="n">sampto</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_raw</span><span class="p">[</span><span class="n">sampfrom</span><span class="p">:</span><span class="n">sampto</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="n">x_raw</span><span class="p">[</span><span class="n">sampfrom</span><span class="p">:</span><span class="n">sampto</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_raw</span><span class="p">[</span><span class="n">sampfrom</span><span class="p">:</span><span class="n">sampto</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="n">x_raw</span><span class="p">[</span><span class="n">sampfrom</span><span class="p">:</span><span class="n">sampto</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;z&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Raw Movement Data&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/bckup1_processing_6_0.png" src="_images/bckup1_processing_6_0.png" />
<img alt="_images/bckup1_processing_6_1.png" src="_images/bckup1_processing_6_1.png" />
</div>
</div>
</div>
<div class="section" id="load-a-sample-of-labels">
<h2>Load a sample of Labels<a class="headerlink" href="#load-a-sample-of-labels" title="Permalink to this headline">¶</a></h2>
<p>The labels correspond to the following sleep states:</p>
<p>(undefined = -1, wake = 0, N1 = 1, N2 = 2, N3 = 3, REM = 5)</p>
<p>Non-REM sleep is divided into progressively deeper stages of sleep: stage N1, stage N2, and stage N3.</p>
<p>As the authors never took note of what the -1 label referred to, we decided it made sense to remove these labels later for our analysis</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Load the labels for one subject</span>
<span class="n">labels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="s1">&#39;./data/labels/46343_labeled_sleep.txt&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">labels</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">labels</span><span class="p">[:,</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(567, 2)
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([-1.,  0.,  1.,  2.,  3.,  5.])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Show me a sample of the labels</span>
<span class="nb">print</span><span class="p">(</span><span class="n">labels</span><span class="p">[</span><span class="mi">520</span><span class="p">:</span><span class="mi">530</span><span class="p">,:])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[[1.560e+04 2.000e+00]
 [1.563e+04 2.000e+00]
 [1.566e+04 2.000e+00]
 [1.569e+04 0.000e+00]
 [1.572e+04 0.000e+00]
 [1.575e+04 1.000e+00]
 [1.578e+04 1.000e+00]
 [1.581e+04 1.000e+00]
 [1.584e+04 0.000e+00]
 [1.587e+04 1.000e+00]]
</pre></div>
</div>
</div>
</div>
<p>The labels are given as:</p>
<p>[time since PSG start, sleep state]</p>
</div>
<hr class="docutils" />
<div class="section" id="tip">
<h2>Tip:<a class="headerlink" href="#tip" title="Permalink to this headline">¶</a></h2>
<p>You will have to segment your ‘X’ data to match the intervals of your ‘y’ data. See cell below:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;First 10 label times (sec): &quot;</span><span class="p">,</span> <span class="n">labels</span><span class="p">[:</span><span class="mi">10</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Index of X data where time less than or equal to 30: &quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">x_clean</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">30</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>First 10 label times (sec):  [  0.  30.  60.  90. 120. 150. 180. 210. 240. 270.]
Index of X data where time less than or equal to 30:  1503
</pre></div>
</div>
</div>
</div>
<p>The labels are segmented into 30 second sections for this subject. The ‘X’ data is not.</p>
<p>Look at <code class="docutils literal notranslate"><span class="pre">x_clean</span></code>, the first 1503 datapoints cover the sleep period from 0-30 seconds.</p>
<p>You will need to segment the data in some way to suit your approach.</p>
<hr class="docutils" />
</div>
</div>
<hr class="docutils" />
<div class="section" id="data-processing">
<h1>Data Processing<a class="headerlink" href="#data-processing" title="Permalink to this headline">¶</a></h1>
<div class="section" id="processing-the-data-so-we-can-use-tsfresh-to-extract-the-time-series-features">
<h2>Processing the data so we can use tsfresh to extract the time series features<a class="headerlink" href="#processing-the-data-so-we-can-use-tsfresh-to-extract-the-time-series-features" title="Permalink to this headline">¶</a></h2>
<p>Our first step was to get the full set of patient IDs which would be needed throughout the data processing</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Get a set of patient ids</span>
<span class="n">FULL_SET</span> <span class="o">=</span> <span class="p">[]</span>

<span class="kn">import</span> <span class="nn">os</span>

<span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="s2">&quot;./outputs/cropped/&quot;</span><span class="p">):</span>
  <span class="n">patient_id</span> <span class="o">=</span> <span class="n">filename</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
  <span class="k">if</span> <span class="n">patient_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">FULL_SET</span><span class="p">:</span> 
        <span class="n">FULL_SET</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">patient_id</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">FULL_SET</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;8692923&#39;, &#39;46343&#39;, &#39;1360686&#39;, &#39;9618981&#39;, &#39;844359&#39;, &#39;6220552&#39;, &#39;8000685&#39;, &#39;781756&#39;, &#39;1818471&#39;, &#39;759667&#39;, &#39;8173033&#39;, &#39;4314139&#39;, &#39;3997827&#39;, &#39;8530312&#39;, &#39;4426783&#39;, &#39;2598705&#39;, &#39;5132496&#39;, &#39;7749105&#39;, &#39;5797046&#39;, &#39;1449548&#39;, &#39;2638030&#39;, &#39;9961348&#39;, &#39;5383425&#39;, &#39;4018081&#39;, &#39;5498603&#39;, &#39;8686948&#39;, &#39;1066528&#39;, &#39;8258170&#39;, &#39;1455390&#39;, &#39;9106476&#39;, &#39;3509524&#39;]
</pre></div>
</div>
</div>
</div>
<p>We then needed to decide what features would be needed, we knew that we needed the motion data and the heart rate data but that the stepcounts wouldn’t be useful here. Therefore our feature set was motion and heartrate.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># choose what features we will use</span>
<span class="n">feature_set</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;motion&quot;</span> <span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;hr&quot;</span> <span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;counts&quot;</span> <span class="p">:</span> <span class="kc">False</span><span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<p>We wanted to take a look at how much datapoints there were for each patient to get an idea of what we would be dealing with. We saw here that there were 850,024 for patient ID 46343</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="c1"># we have 850,024 motion readings for this patient</span>
<span class="n">motion_clean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="s1">&#39;./outputs/cropped/46343_cleaned_motion.out&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">motion_clean</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">motion_clean</span><span class="p">[:</span><span class="mi">10</span><span class="p">,:])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(850024, 4)
[[ 7.21000e-04 -2.34650e-01  9.05975e-01  3.62747e-01]
 [ 1.71620e-02 -2.31232e-01  8.93265e-01  3.71613e-01]
 [ 3.71830e-02 -2.27814e-01  9.15848e-01  3.69049e-01]
 [ 5.71080e-02 -2.40524e-01  9.19159e-01  3.52890e-01]
 [ 7.69290e-02 -2.40448e-01  8.89175e-01  3.50143e-01]
 [ 9.72060e-02 -2.30652e-01  8.98056e-01  3.54538e-01]
 [ 1.16890e-01 -2.44370e-01  8.88184e-01  3.49152e-01]
 [ 1.36826e-01 -2.45895e-01  8.91678e-01  3.55942e-01]
 [ 1.71897e-01 -2.46414e-01  9.04938e-01  3.55866e-01]
 [ 1.76799e-01 -2.49878e-01  8.99094e-01  3.62213e-01]]
</pre></div>
</div>
</div>
</div>
<p>There were 3,301 heartrate measurements for this same patient</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># we have 3,301 HR readings for the same patient</span>
<span class="n">hr_clean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="s1">&#39;./outputs/cropped/46343_cleaned_hr.out&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">hr_clean</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(3301, 2)
</pre></div>
</div>
</div>
</div>
<p>However, we only have 567 sleep status labels for this same patient. Clearly there would be signficant work involved in matching the motion and heartrate data to these sleep status labels</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Load the labels for one subject</span>
<span class="n">labels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="s1">&#39;./data/labels/46343_labeled_sleep.txt&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">labels</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(567, 2)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Show me a sample of the labels</span>
<span class="nb">print</span><span class="p">(</span><span class="n">labels</span><span class="p">[</span><span class="mi">520</span><span class="p">:</span><span class="mi">530</span><span class="p">,:])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[[1.560e+04 2.000e+00]
 [1.563e+04 2.000e+00]
 [1.566e+04 2.000e+00]
 [1.569e+04 0.000e+00]
 [1.572e+04 0.000e+00]
 [1.575e+04 1.000e+00]
 [1.578e+04 1.000e+00]
 [1.581e+04 1.000e+00]
 [1.584e+04 0.000e+00]
 [1.587e+04 1.000e+00]]
</pre></div>
</div>
</div>
</div>
<p>The index differed in each file and so we needed to calculate it for each patient individually</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># the index isn&#39;t the same for every file so we will need to calculate this for each patient</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;First 10 label times (sec): &quot;</span><span class="p">,</span> <span class="n">labels</span><span class="p">[:</span><span class="mi">10</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Index of Motion data where time less than or equal to 30: &quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">motion_clean</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">30</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Index of HR data where time less than or equal to 30: &quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">hr_clean</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">30</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>First 10 label times (sec):  [  0.  30.  60.  90. 120. 150. 180. 210. 240. 270.]
Index of Motion data where time less than or equal to 30:  1503
Index of HR data where time less than or equal to 30:  5
</pre></div>
</div>
</div>
</div>
<p>Next we created a function that would create chunks from the motion data and the heartrate data and align it with our sleep status label data</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># we need to chunk motion and hr data into 30 sec block so it aligns with labels</span>

<span class="k">def</span> <span class="nf">groupedAvg</span><span class="p">(</span><span class="n">myArray</span><span class="p">,</span> <span class="n">N</span><span class="p">):</span>
    <span class="n">myArray</span> <span class="o">=</span> <span class="n">myArray</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:]</span> <span class="c1"># remove time column</span>
    <span class="n">cum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">myArray</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">cum</span><span class="p">[</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">::</span><span class="n">N</span><span class="p">]</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
    <span class="n">result</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">-</span> <span class="n">result</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="n">remainder</span> <span class="o">=</span> <span class="n">myArray</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">%</span> <span class="n">N</span>
    <span class="k">if</span> <span class="n">remainder</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">remainder</span> <span class="o">&lt;</span> <span class="n">myArray</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="n">lastAvg</span> <span class="o">=</span> <span class="p">(</span><span class="n">cum</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">cum</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="n">remainder</span><span class="p">])</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">remainder</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">lastAvg</span> <span class="o">=</span> <span class="n">cum</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">remainder</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">result</span><span class="p">,</span> <span class="n">lastAvg</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">result</span>

<span class="n">chunked</span> <span class="o">=</span> <span class="n">groupedAvg</span><span class="p">(</span><span class="n">motion_clean</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="mi">1503</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">chunked</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">])</span>
<span class="c1"># remember we have 567 sleep labels for subject 46343</span>
<span class="c1"># i think this is missing the first reading, because it takes the first N values to</span>
<span class="c1"># represent the 30sec bin, not 0 seconds</span>
<span class="nb">len</span><span class="p">(</span><span class="n">chunked</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[[-0.25686582  0.86873005  0.39853218]
 [-0.33024043  0.90030214  0.2312925 ]
 [-0.39903006  0.90663435  0.07760914]]
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>566
</pre></div>
</div>
</div>
</div>
<p>We noticed that there wasnt a consistent amount of heartrate readings in each 30 second chunk, some chunks had 5 while others had 6. So we had to check each one and ensure we captured the correct number for it</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># this looks like it works above but from the length below we see it doesn&#39;t match up.</span>
<span class="c1"># thats because the hr gets 5 readings in one 30sec period, 6 in the next, 5 in the next, etc...</span>
<span class="c1"># it doesn&#39;t seem to give consistent number of readings every 30sec</span>
<span class="c1"># so we&#39;ll need to check it every bin and change bin N to get every value</span>
<span class="n">hr_blocked</span> <span class="o">=</span> <span class="n">groupedAvg</span><span class="p">(</span><span class="n">hr_clean</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">hr_blocked</span><span class="p">[:</span><span class="mi">3</span><span class="p">])</span>
<span class="nb">len</span><span class="p">(</span><span class="n">hr_blocked</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[[95.6]
 [89.4]
 [79.8]]
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>661
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># this function will take the subject id, and feature set chosen by us</span>
<span class="c1"># it will open the feature file and group the readings into 30sec intervals.</span>
<span class="c1"># the output is a subject feature dictionary, with &quot;key&quot; : &quot;value&quot; being</span>
<span class="c1"># &lt;feature&gt; : &lt;pandas dataframe containing feature values that match label times&gt;</span>

<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="k">def</span> <span class="nf">interpolate_features</span><span class="p">(</span><span class="n">subject_id</span><span class="p">,</span> <span class="n">feature_set</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">):</span>
  <span class="n">subject_features</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

  <span class="n">labels</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_table</span><span class="p">(</span><span class="s1">&#39;./data/labels/</span><span class="si">{}</span><span class="s1">_labeled_sleep.txt&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">subject_id</span><span class="p">),</span>
                         <span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">delim_whitespace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
  
  <span class="n">bin_index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Index</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">0.00</span><span class="p">,</span> <span class="n">labels</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mi">30</span><span class="p">,</span> <span class="mf">30.0</span><span class="p">))</span>

  <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">length of subject </span><span class="si">{}</span><span class="s2">&#39;s labels file: </span><span class="si">{}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">subject_id</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">labels</span><span class="p">)))</span>

  <span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">feature_set</span><span class="p">:</span>

    <span class="k">if</span> <span class="n">feature_set</span><span class="p">[</span><span class="n">feature</span><span class="p">]:</span>

      <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Interpolating </span><span class="si">{}</span><span class="s2"> feature for subject </span><span class="si">{}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">feature</span><span class="p">,</span> <span class="n">subject_id</span><span class="p">))</span>

      <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_table</span><span class="p">(</span><span class="s1">&#39;./outputs/cropped/</span><span class="si">{}</span><span class="s1">_cleaned_</span><span class="si">{}</span><span class="s1">.out&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">subject_id</span><span class="p">,</span> <span class="n">feature</span><span class="p">),</span>
                         <span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">delim_whitespace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

      <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">bin_index</span><span class="p">))</span>
      <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">interpolate</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span> <span class="n">limit_direction</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">)</span>
      <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">index</span> <span class="o">%</span> <span class="mi">30</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span>

      <span class="n">subject_features</span><span class="p">[</span><span class="n">feature</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span>

  <span class="k">return</span> <span class="n">subject_features</span><span class="p">,</span> <span class="n">labels</span>


<span class="n">subject_id</span> <span class="o">=</span> <span class="mi">46343</span> <span class="c1">#1066528 #7749105 #2598705 #4018081 #1360686 #8686948 #844359 #5383425 </span>

<span class="n">sub_feats</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">interpolate_features</span><span class="p">(</span><span class="n">subject_id</span><span class="p">,</span> <span class="n">feature_set</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">sub_feats</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/usr/local/lib/python3.6/dist-packages/ipykernel_launcher.py:14: FutureWarning: The pandas.np module is deprecated and will be removed from pandas in a future version. Import numpy directly instead
  
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>length of subject 46343&#39;s labels file: 567

Interpolating motion feature for subject 46343

Interpolating hr feature for subject 46343

{&#39;motion&#39;:                 1         2         3
0.0     -0.234650  0.905975  0.362747
30.0    -0.319740  0.785706  0.504722
60.0    -0.353561  0.906471  0.207405
90.0    -0.502312  0.887284 -0.015900
120.0   -0.343017  0.912331 -0.151993
...           ...       ...       ...
16860.0 -0.444634 -0.528549  0.723931
16890.0 -0.442429 -0.525840  0.724411
16920.0 -0.440208 -0.525605  0.723693
16950.0 -0.440704 -0.525353  0.724418
16980.0 -0.441925 -0.524628  0.722458

[567 rows x 3 columns], &#39;hr&#39;:             1
0.0      97.0
30.0     95.0
60.0     81.5
90.0     84.5
120.0    82.5
...       ...
16860.0  76.0
16890.0  77.0
16920.0  75.0
16950.0  73.0
16980.0  76.0

[567 rows x 1 columns]}
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># these functions will allow us to plot our interpolated features</span>

<span class="k">def</span> <span class="nf">plot_hr_df</span><span class="p">(</span><span class="n">sub_feats</span><span class="p">,</span> <span class="n">sampfrom</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">sampto</span><span class="o">=</span><span class="mi">85000</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">7</span><span class="p">))</span>
    <span class="n">feature</span> <span class="o">=</span> <span class="s2">&quot;hr&quot;</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sub_feats</span><span class="p">[</span><span class="n">feature</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">sampfrom</span><span class="p">:</span><span class="n">sampto</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span><span class="n">sub_feats</span><span class="p">[</span><span class="n">feature</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">sampfrom</span><span class="p">:</span><span class="n">sampto</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Time (sec)&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;HR (bpm)&quot;</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Downsampled HR data&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">plot_motion_df</span><span class="p">(</span><span class="n">sub_feats</span><span class="p">,</span> <span class="n">sampfrom</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">sampto</span><span class="o">=</span><span class="mi">85000</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">7</span><span class="p">))</span>
    <span class="n">feature</span> <span class="o">=</span> <span class="s2">&quot;motion&quot;</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sub_feats</span><span class="p">[</span><span class="n">feature</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">sampfrom</span><span class="p">:</span><span class="n">sampto</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span><span class="n">sub_feats</span><span class="p">[</span><span class="n">feature</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">sampfrom</span><span class="p">:</span><span class="n">sampto</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sub_feats</span><span class="p">[</span><span class="n">feature</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">sampfrom</span><span class="p">:</span><span class="n">sampto</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span><span class="n">sub_feats</span><span class="p">[</span><span class="n">feature</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">sampfrom</span><span class="p">:</span><span class="n">sampto</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sub_feats</span><span class="p">[</span><span class="n">feature</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">sampfrom</span><span class="p">:</span><span class="n">sampto</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span><span class="n">sub_feats</span><span class="p">[</span><span class="n">feature</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">sampfrom</span><span class="p">:</span><span class="n">sampto</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;z&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Time (sec)&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Motion&quot;</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Downsampled Motion data&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="n">plot_hr_df</span><span class="p">(</span><span class="n">sub_feats</span><span class="p">)</span>
<span class="n">plot_motion_df</span><span class="p">(</span><span class="n">sub_feats</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/bckup1_processing_33_0.png" src="_images/bckup1_processing_33_0.png" />
<img alt="_images/bckup1_processing_33_1.png" src="_images/bckup1_processing_33_1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">labels</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
<span class="n">labels</span><span class="o">.</span><span class="n">index</span><span class="o">*</span><span class="mi">30</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>     0  1
0    0 -1
1   30 -1
2   60 -1
3   90 -1
4  120 -1
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>RangeIndex(start=0, stop=17010, step=30)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sub_feats</span><span class="p">[</span><span class="s2">&quot;hr&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[:</span><span class="mi">510</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>1</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0.0</th>
      <td>97.0</td>
    </tr>
    <tr>
      <th>30.0</th>
      <td>95.0</td>
    </tr>
    <tr>
      <th>60.0</th>
      <td>81.5</td>
    </tr>
    <tr>
      <th>90.0</th>
      <td>84.5</td>
    </tr>
    <tr>
      <th>120.0</th>
      <td>82.5</td>
    </tr>
    <tr>
      <th>150.0</th>
      <td>86.5</td>
    </tr>
    <tr>
      <th>180.0</th>
      <td>86.0</td>
    </tr>
    <tr>
      <th>210.0</th>
      <td>81.5</td>
    </tr>
    <tr>
      <th>240.0</th>
      <td>81.5</td>
    </tr>
    <tr>
      <th>270.0</th>
      <td>83.5</td>
    </tr>
    <tr>
      <th>300.0</th>
      <td>84.5</td>
    </tr>
    <tr>
      <th>330.0</th>
      <td>81.5</td>
    </tr>
    <tr>
      <th>360.0</th>
      <td>89.5</td>
    </tr>
    <tr>
      <th>390.0</th>
      <td>90.0</td>
    </tr>
    <tr>
      <th>420.0</th>
      <td>101.0</td>
    </tr>
    <tr>
      <th>450.0</th>
      <td>92.0</td>
    </tr>
    <tr>
      <th>480.0</th>
      <td>82.0</td>
    </tr>
    <tr>
      <th>510.0</th>
      <td>83.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</div>
<div class="section" id="label-4">
<h2>Label “4”?<a class="headerlink" href="#label-4" title="Permalink to this headline">¶</a></h2>
<p>At this stage of the processing and analysis we noticed something odd, there appeared to be some “4”s in the list of sleep status labels. Up to this point we had assumed there were only [0,1,2,3,5] as we had removed the -1 and the study itself suggested the labels are as follows for sleep stages:</p>
<p><strong>“Each line in this file has the format: date (in seconds since PSG start) stage (0-5, wake = 0, N1 = 1, N2 = 2, N3 = 3, REM = 5)”</strong></p>
<p>We decided to remove this from the dataset similar along with the “-1” label, as once again we weren’t aware of what it actually meant</p>
<p>The function below, “remove_noise” achieves this</p>
<p>![Screenshot from 2020-11-14 16-39-47.png](data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAABcIAAADZCAYAAAADp0MrAAAAinpUWHRSYXcgcHJvZmlsZSB0eXBlIGV4aWYAAHjaVY7LDcQwCETvVJESho/BlLPKJtJ2sOUHx5EivwMMaDRAx/930jZgGFmL7umOwtJSPiU6JgqwgEevOnm6cimp8ZlJZQrPHrDXaIaFpt79DIvw5rvvUulyqN6VFXS7Rth4Jd+gcrZ5et1/cz1AFwCqLUoH7wnfAAAKCGlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4KPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iWE1QIENvcmUgNC40LjAtRXhpdjIiPgogPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4KICA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIgogICAgeG1sbnM6ZXhpZj0iaHR0cDovL25zLmFkb2JlLmNvbS9leGlmLzEuMC8iCiAgICB4bWxuczp0aWZmPSJodHRwOi8vbnMuYWRvYmUuY29tL3RpZmYvMS4wLyIKICAgZXhpZjpQaXhlbFhEaW1lbnNpb249IjE0NzQiCiAgIGV4aWY6UGl4ZWxZRGltZW5zaW9uPSIyMTciCiAgIHRpZmY6SW1hZ2VXaWR0aD0iMTQ3NCIKICAgdGlmZjpJbWFnZUhlaWdodD0iMjE3IgogICB0aWZmOk9yaWVudGF0aW9uPSIxIi8+CiA8L3JkZjpSREY+CjwveDp4bXBtZXRhPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg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)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># the times at which label is -1 or 4. We want to remove these time instances from the training data</span>
<span class="c1"># because we do not know what class it is</span>

<span class="k">def</span> <span class="nf">remove_noise</span><span class="p">(</span><span class="n">subject_feats</span><span class="p">,</span> <span class="n">labels</span><span class="p">):</span>

    <span class="c1">#noise_index = labels.loc[labels[1] == -1].index</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">labels</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
    <span class="n">noise_index</span> <span class="o">=</span> <span class="n">labels</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">labels</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">])]</span><span class="o">.</span><span class="n">index</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;noise index:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">noise_index</span><span class="p">)</span>

    <span class="n">labels</span> <span class="o">=</span> <span class="n">labels</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">noise_index</span><span class="p">)</span>
    <span class="n">labels</span> <span class="o">=</span> <span class="n">labels</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">subject_feats</span><span class="p">:</span>

      <span class="n">subject_feats</span><span class="p">[</span><span class="n">feature</span><span class="p">]</span> <span class="o">=</span> <span class="n">subject_feats</span><span class="p">[</span><span class="n">feature</span><span class="p">]</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">noise_index</span><span class="o">*</span><span class="mi">30</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">subject_feats</span><span class="p">,</span> <span class="n">labels</span>

<span class="n">sub_feats</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">remove_noise</span><span class="p">(</span><span class="n">sub_feats</span><span class="p">,</span> <span class="n">labels</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Int64Index([0, 1], dtype=&#39;int64&#39;)
noise index:
 Int64Index([0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12], dtype=&#39;int64&#39;)
</pre></div>
</div>
</div>
</div>
<p>Below we can now see that the entries in out sub_feats from 0 seconds to 360 seconds have been removed as their labels matched either -1 or 4</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># our hr feature data after noise index entries were removed for this subject...</span>
<span class="n">sub_feats</span><span class="p">[</span><span class="s2">&quot;hr&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[:</span><span class="mi">510</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>1</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>390.0</th>
      <td>90.0</td>
    </tr>
    <tr>
      <th>420.0</th>
      <td>101.0</td>
    </tr>
    <tr>
      <th>450.0</th>
      <td>92.0</td>
    </tr>
    <tr>
      <th>480.0</th>
      <td>82.0</td>
    </tr>
    <tr>
      <th>510.0</th>
      <td>83.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>And likewise, these same entries in the label data are gone also</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># ...and the matching labels</span>
<span class="n">labels</span><span class="o">.</span><span class="n">loc</span><span class="p">[:</span><span class="mi">510</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>1</th>
    </tr>
    <tr>
      <th>0</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>390</th>
      <td>0</td>
    </tr>
    <tr>
      <th>420</th>
      <td>0</td>
    </tr>
    <tr>
      <th>450</th>
      <td>0</td>
    </tr>
    <tr>
      <th>480</th>
      <td>0</td>
    </tr>
    <tr>
      <th>510</th>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>The following print statements show us that all of our times now line up nicely</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># now that the times all line up</span>
<span class="c1"># we can combine all the features in our dictionary to use as training/testing sets</span>

<span class="nb">print</span><span class="p">(</span><span class="n">labels</span><span class="o">.</span><span class="n">loc</span><span class="p">[:</span><span class="mi">510</span><span class="p">],</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">sub_feats</span><span class="p">[</span><span class="s2">&quot;motion&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[:</span><span class="mi">510</span><span class="p">],</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">sub_feats</span><span class="p">[</span><span class="s2">&quot;hr&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[:</span><span class="mi">510</span><span class="p">],</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>     1
0     
390  0
420  0
450  0
480  0
510  0 

              1         2         3
390.0 -0.559524  0.690460 -0.220322
420.0 -0.631027  0.672783 -0.314140
450.0 -0.115539  0.853889  0.774826
480.0 -0.345749 -0.284614  0.888367
510.0 -0.315613 -0.276604  0.906998 

           1
390.0   90.0
420.0  101.0
450.0   92.0
480.0   82.0
510.0   83.0 
</pre></div>
</div>
</div>
</div>
<p>We now needed a function that can iterate through the feature set and join our dataframes together, side by side, leaving a single dataframe containing all feature columns, nicely aligned</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># this function will loop through our feature set and horizontally join the dataframes together</span>
<span class="c1"># so our result is one dataframe with all feature columns </span>

<span class="k">def</span> <span class="nf">join_features</span><span class="p">(</span><span class="n">subject_features</span><span class="p">):</span>

    <span class="c1"># join the feature dfs horizontally</span>
    <span class="n">joined_feats</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([])</span>

    <span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">subject_features</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">feature</span> <span class="o">==</span> <span class="s2">&quot;motion&quot;</span><span class="p">:</span>
          <span class="n">subject_features</span><span class="p">[</span><span class="n">feature</span><span class="p">]</span> <span class="o">=</span> <span class="n">subject_features</span><span class="p">[</span><span class="n">feature</span><span class="p">]</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="mi">1</span><span class="p">:</span><span class="s2">&quot;x&quot;</span><span class="p">,</span><span class="mi">2</span><span class="p">:</span><span class="s2">&quot;y&quot;</span><span class="p">,</span><span class="mi">3</span><span class="p">:</span><span class="s2">&quot;z&quot;</span><span class="p">})</span>
        <span class="k">elif</span> <span class="n">feature</span> <span class="o">==</span> <span class="s2">&quot;hr&quot;</span><span class="p">:</span>
          <span class="n">subject_features</span><span class="p">[</span><span class="n">feature</span><span class="p">]</span> <span class="o">=</span> <span class="n">subject_features</span><span class="p">[</span><span class="n">feature</span><span class="p">]</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="mi">1</span><span class="p">:</span><span class="s2">&quot;hr&quot;</span><span class="p">})</span>

        <span class="n">joined_feats</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">joined_feats</span><span class="p">,</span> <span class="n">subject_features</span><span class="p">[</span><span class="n">feature</span><span class="p">]],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">joined_feats</span>

<span class="n">joined_feats</span> <span class="o">=</span> <span class="n">join_features</span><span class="p">(</span><span class="n">sub_feats</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">joined_feats</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                x         y         z     hr
390.0   -0.559524  0.690460 -0.220322   90.0
420.0   -0.631027  0.672783 -0.314140  101.0
450.0   -0.115539  0.853889  0.774826   92.0
480.0   -0.345749 -0.284614  0.888367   82.0
510.0   -0.315613 -0.276604  0.906998   83.0
...           ...       ...       ...    ...
16860.0 -0.444634 -0.528549  0.723931   76.0
16890.0 -0.442429 -0.525840  0.724411   77.0
16920.0 -0.440208 -0.525605  0.723693   75.0
16950.0 -0.440704 -0.525353  0.724418   73.0
16980.0 -0.441925 -0.524628  0.722458   76.0

[554 rows x 4 columns]
</pre></div>
</div>
</div>
</div>
<p>Now that we were happy with the data we could produce for any single subject, we wanted a function that could create this data structure for all of the subjects and join them into two dataframes, one containing time, motion x, motion y, motion z, heartrate; and another with time and the sleep status label.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># make training/testing dataset</span>
<span class="c1"># this returns a feature array of [time - motion x - motion y - motion z - hr] and an aligned array of labels  [time - label]</span>
<span class="c1"># for both the training and test set</span>
<span class="c1"># split paramter will create a set of &quot;train&quot; subjects and &quot;test&quot; subjects</span>
<span class="c1"># add_id paramter will include the subject id in the resulting dataframe - necessary for tsfresh feature extraction</span>

<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>

<span class="k">def</span> <span class="nf">create_train_test</span><span class="p">(</span><span class="n">FULL_SET</span><span class="p">,</span> <span class="n">feature_set</span><span class="p">,</span> <span class="n">split</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">add_id</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>

    <span class="n">training_set_features</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([])</span>
    <span class="n">training_set_true_labels</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([])</span>
    <span class="n">testing_set_features</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([])</span>
    <span class="n">testing_set_true_labels</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([])</span>

    <span class="k">if</span> <span class="n">split</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>

        <span class="k">for</span> <span class="n">subject</span> <span class="ow">in</span> <span class="n">FULL_SET</span><span class="p">:</span>

            <span class="n">subject_features</span><span class="p">,</span> <span class="n">subject_labels</span> <span class="o">=</span> <span class="n">interpolate_features</span><span class="p">(</span><span class="n">subject</span><span class="p">,</span> <span class="n">feature_set</span><span class="p">)</span>

            <span class="n">subject_features</span><span class="p">,</span> <span class="n">subject_labels</span> <span class="o">=</span> <span class="n">remove_noise</span><span class="p">(</span><span class="n">subject_features</span><span class="p">,</span> <span class="n">subject_labels</span><span class="p">)</span>

            <span class="n">joined_features</span> <span class="o">=</span> <span class="n">join_features</span><span class="p">(</span><span class="n">subject_features</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">add_id</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">joined_features</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">subject</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">subject_labels</span><span class="p">))]</span>
                <span class="n">subject_labels</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">subject</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">subject_labels</span><span class="p">))]</span>

            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">training_set_features</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">training_set_features</span> <span class="o">=</span> <span class="n">joined_features</span>
                <span class="n">training_set_true_labels</span> <span class="o">=</span> <span class="n">subject_labels</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">training_set_features</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">((</span><span class="n">training_set_features</span><span class="p">,</span> <span class="n">joined_features</span><span class="p">))</span>
                <span class="n">training_set_true_labels</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">((</span><span class="n">training_set_true_labels</span><span class="p">,</span> <span class="n">subject_labels</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">training_set_features</span><span class="p">,</span> <span class="n">training_set_true_labels</span>


    <span class="n">training_subjects</span><span class="p">,</span> <span class="n">testing_subjects</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">FULL_SET</span><span class="p">,</span> <span class="n">test_size</span> <span class="o">=</span> <span class="n">test_size</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;training set:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">training_subjects</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;testing set:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">testing_subjects</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Get labels and features for training and testing sets</span>
    <span class="k">for</span> <span class="n">subject</span> <span class="ow">in</span> <span class="n">training_subjects</span><span class="p">:</span>

        <span class="n">subject_features</span><span class="p">,</span> <span class="n">subject_labels</span> <span class="o">=</span> <span class="n">interpolate_features</span><span class="p">(</span><span class="n">subject</span><span class="p">,</span> <span class="n">feature_set</span><span class="p">)</span>

        <span class="n">subject_features</span><span class="p">,</span> <span class="n">subject_labels</span> <span class="o">=</span> <span class="n">remove_noise</span><span class="p">(</span><span class="n">subject_features</span><span class="p">,</span> <span class="n">subject_labels</span><span class="p">)</span>

        <span class="n">joined_features</span> <span class="o">=</span> <span class="n">join_features</span><span class="p">(</span><span class="n">subject_features</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">training_set_features</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">training_set_features</span> <span class="o">=</span> <span class="n">joined_features</span>
            <span class="n">training_set_true_labels</span> <span class="o">=</span> <span class="n">subject_labels</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">training_set_features</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">((</span><span class="n">training_set_features</span><span class="p">,</span> <span class="n">joined_features</span><span class="p">))</span>
            <span class="n">training_set_true_labels</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">((</span><span class="n">training_set_true_labels</span><span class="p">,</span> <span class="n">subject_labels</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">subject</span> <span class="ow">in</span> <span class="n">testing_subjects</span><span class="p">:</span>

        <span class="n">subject_features</span><span class="p">,</span> <span class="n">subject_labels</span> <span class="o">=</span> <span class="n">interpolate_features</span><span class="p">(</span><span class="n">subject</span><span class="p">,</span> <span class="n">feature_set</span><span class="p">)</span>

        <span class="n">subject_features</span><span class="p">,</span> <span class="n">subject_labels</span> <span class="o">=</span> <span class="n">remove_noise</span><span class="p">(</span><span class="n">subject_features</span><span class="p">,</span> <span class="n">subject_labels</span><span class="p">)</span>

        <span class="n">joined_features</span> <span class="o">=</span> <span class="n">join_features</span><span class="p">(</span><span class="n">subject_features</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">testing_set_features</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">testing_set_features</span> <span class="o">=</span> <span class="n">joined_features</span>
            <span class="n">testing_set_true_labels</span> <span class="o">=</span> <span class="n">subject_labels</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">testing_set_features</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">((</span><span class="n">testing_set_features</span><span class="p">,</span> <span class="n">joined_features</span><span class="p">))</span>
            <span class="n">testing_set_true_labels</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">((</span><span class="n">testing_set_true_labels</span><span class="p">,</span> <span class="n">subject_labels</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">training_set_features</span><span class="p">,</span> <span class="n">training_set_true_labels</span><span class="p">,</span> <span class="n">testing_set_features</span><span class="p">,</span> <span class="n">testing_set_true_labels</span>


<span class="n">training_set_features</span><span class="p">,</span> <span class="n">training_set_true_labels</span><span class="p">,</span> <span class="n">testing_set_features</span><span class="p">,</span> <span class="n">testing_set_true_labels</span> <span class="o">=</span> <span class="n">create_train_test</span><span class="p">(</span><span class="n">FULL_SET</span><span class="p">,</span> <span class="n">feature_set</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>

<span class="n">full_set_features</span><span class="p">,</span> <span class="n">full_set_true_labels</span> <span class="o">=</span> <span class="n">create_train_test</span><span class="p">(</span><span class="n">FULL_SET</span><span class="p">,</span> <span class="n">feature_set</span><span class="p">,</span> <span class="n">split</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">add_id</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">full_set_features</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;/content/drive/My Drive/CA4015/sleep_classify/raw_windowed_features.csv&#39;</span><span class="p">)</span>
<span class="n">full_set_true_labels</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;/content/drive/My Drive/CA4015/sleep_classify/raw_windowed_labels.csv&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Here is a sample of what the above function outputs as it runs, the full output is very long and would take up most of this notebook so we have hidden it:</p>
<p>“length of subject 8258170’s labels file: 972</p>
<p>Interpolating motion feature for subject 8258170</p>
<p>/usr/local/lib/python3.6/dist-packages/ipykernel_launcher.py:14: FutureWarning: The pandas.np module is deprecated and will be removed from pandas in a future version. Import numpy directly instead</p>
<p>Interpolating hr feature for subject 8258170</p>
<p>Int64Index([0, 1], dtype=’int64’)
noise index:
Int64Index([150, 151, 155, 156, 157, 158, 159, 160, 161, 162, 163, 164, 169,
175, 177, 178, 179, 180, 181, 182, 183, 184, 185, 186, 187, 188,
189, 190, 191, 192, 193, 194, 195, 196, 197, 198, 199, 200, 202,
203, 204, 205, 206, 207, 208, 209, 210, 211, 212, 213, 214, 215,
216, 217, 218, 219, 220, 221, 222, 223, 398, 400, 401, 403, 405,
408, 409, 410, 411, 418, 419, 420, 421, 422, 423, 424, 425, 426,
427, 428, 429, 430, 431],
dtype=’int64’)”</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">full_set_true_labels</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([0, 1, 2, 3, 5])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Training Set Features&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">training_set_features</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Training Set Features&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">training_set_true_labels</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Training Set Features 
                 x         y         z    hr
0.0     -0.234604  0.643829 -0.713974  65.0
30.0    -0.301849 -0.205375 -0.931488  57.5
60.0    -0.300629 -0.200714 -0.931015  51.5
90.0    -0.296928 -0.199501 -0.934410  50.0
120.0   -0.300675 -0.192085 -0.927177  47.5
...           ...       ...       ...   ...
29340.0 -0.945655  0.049217 -0.322846  66.5
29370.0  0.539521 -0.754646 -0.126137  66.0
29400.0 -0.711884 -0.111618 -0.696038  62.0
29430.0 -0.697182 -0.104553 -0.710816  61.5
29460.0 -0.690986 -0.102600 -0.715798  63.0

[20185 rows x 4 columns]
Training Set Features 
        1
0       
0      0
30     0
60     0
90     0
120    0
...   ..
29340  2
29370  1
29400  1
29430  1
29460  1

[20185 rows x 1 columns]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Testing Set Features&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">testing_set_features</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Testing Set Features&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">testing_set_true_labels</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Testing Set Features 
                 x         y         z    hr
240.0   -0.812561 -0.581581  0.023765  77.0
270.0   -0.721108 -0.097038 -0.679436  79.5
300.0    0.415924  0.194603 -0.629395  73.0
330.0   -0.081154  0.423157 -0.895424  73.0
360.0   -0.083824  0.422409 -0.900138  75.0
...           ...       ...       ...   ...
29250.0 -0.109840 -0.955604  0.262016  57.0
29280.0 -0.110085 -0.956581  0.262017  61.0
29310.0 -0.110580 -0.957809  0.262252  63.5
29340.0 -0.112793 -0.955124  0.260727  62.0
29370.0 -0.111054 -0.953903  0.259033  58.0

[6232 rows x 4 columns]
Testing Set Features 
        1
0       
240    0
270    0
300    0
330    0
360    0
...   ..
29250  5
29280  5
29310  5
29340  5
29370  5

[6232 rows x 1 columns]
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="extracting-features">
<h2>Extracting features<a class="headerlink" href="#extracting-features" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>!pip install tsfresh
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Requirement already satisfied: tsfresh in /usr/local/lib/python3.6/dist-packages (0.17.0)
Requirement already satisfied: scikit-learn&gt;=0.19.2 in /usr/local/lib/python3.6/dist-packages (from tsfresh) (0.22.2.post1)
Requirement already satisfied: dask[dataframe]&gt;=2.9.0 in /usr/local/lib/python3.6/dist-packages (from tsfresh) (2.12.0)
Requirement already satisfied: pandas&gt;=0.25.0 in /usr/local/lib/python3.6/dist-packages (from tsfresh) (1.1.4)
Requirement already satisfied: statsmodels&gt;=0.9.0 in /usr/local/lib/python3.6/dist-packages (from tsfresh) (0.10.2)
Requirement already satisfied: distributed&gt;=2.11.0 in /usr/local/lib/python3.6/dist-packages (from tsfresh) (2.30.1)
Requirement already satisfied: tqdm&gt;=4.10.0 in /usr/local/lib/python3.6/dist-packages (from tsfresh) (4.41.1)
Requirement already satisfied: requests&gt;=2.9.1 in /usr/local/lib/python3.6/dist-packages (from tsfresh) (2.23.0)
Requirement already satisfied: numpy&gt;=1.15.1 in /usr/local/lib/python3.6/dist-packages (from tsfresh) (1.18.5)
Requirement already satisfied: scipy&gt;=1.2.0 in /usr/local/lib/python3.6/dist-packages (from tsfresh) (1.4.1)
Requirement already satisfied: patsy&gt;=0.4.1 in /usr/local/lib/python3.6/dist-packages (from tsfresh) (0.5.1)
Requirement already satisfied: joblib&gt;=0.11 in /usr/local/lib/python3.6/dist-packages (from scikit-learn&gt;=0.19.2-&gt;tsfresh) (0.17.0)
Requirement already satisfied: partd&gt;=0.3.10; extra == &quot;dataframe&quot; in /usr/local/lib/python3.6/dist-packages (from dask[dataframe]&gt;=2.9.0-&gt;tsfresh) (1.1.0)
Requirement already satisfied: toolz&gt;=0.7.3; extra == &quot;dataframe&quot; in /usr/local/lib/python3.6/dist-packages (from dask[dataframe]&gt;=2.9.0-&gt;tsfresh) (0.11.1)
Requirement already satisfied: fsspec&gt;=0.6.0; extra == &quot;dataframe&quot; in /usr/local/lib/python3.6/dist-packages (from dask[dataframe]&gt;=2.9.0-&gt;tsfresh) (0.8.4)
Requirement already satisfied: pytz&gt;=2017.2 in /usr/local/lib/python3.6/dist-packages (from pandas&gt;=0.25.0-&gt;tsfresh) (2018.9)
Requirement already satisfied: python-dateutil&gt;=2.7.3 in /usr/local/lib/python3.6/dist-packages (from pandas&gt;=0.25.0-&gt;tsfresh) (2.8.1)
Requirement already satisfied: psutil&gt;=5.0 in /usr/local/lib/python3.6/dist-packages (from distributed&gt;=2.11.0-&gt;tsfresh) (5.4.8)
Requirement already satisfied: setuptools in /usr/local/lib/python3.6/dist-packages (from distributed&gt;=2.11.0-&gt;tsfresh) (50.3.2)
Requirement already satisfied: contextvars; python_version &lt; &quot;3.7&quot; in /usr/local/lib/python3.6/dist-packages (from distributed&gt;=2.11.0-&gt;tsfresh) (2.4)
Requirement already satisfied: click&gt;=6.6 in /usr/local/lib/python3.6/dist-packages (from distributed&gt;=2.11.0-&gt;tsfresh) (7.1.2)
Requirement already satisfied: tblib&gt;=1.6.0 in /usr/local/lib/python3.6/dist-packages (from distributed&gt;=2.11.0-&gt;tsfresh) (1.7.0)
Requirement already satisfied: zict&gt;=0.1.3 in /usr/local/lib/python3.6/dist-packages (from distributed&gt;=2.11.0-&gt;tsfresh) (2.0.0)
Requirement already satisfied: msgpack&gt;=0.6.0 in /usr/local/lib/python3.6/dist-packages (from distributed&gt;=2.11.0-&gt;tsfresh) (1.0.0)
Requirement already satisfied: cloudpickle&gt;=1.5.0 in /usr/local/lib/python3.6/dist-packages (from distributed&gt;=2.11.0-&gt;tsfresh) (1.6.0)
Requirement already satisfied: pyyaml in /usr/local/lib/python3.6/dist-packages (from distributed&gt;=2.11.0-&gt;tsfresh) (3.13)
Requirement already satisfied: sortedcontainers!=2.0.0,!=2.0.1 in /usr/local/lib/python3.6/dist-packages (from distributed&gt;=2.11.0-&gt;tsfresh) (2.2.2)
Requirement already satisfied: tornado&gt;=5; python_version &lt; &quot;3.8&quot; in /usr/local/lib/python3.6/dist-packages (from distributed&gt;=2.11.0-&gt;tsfresh) (5.1.1)
Requirement already satisfied: urllib3!=1.25.0,!=1.25.1,&lt;1.26,&gt;=1.21.1 in /usr/local/lib/python3.6/dist-packages (from requests&gt;=2.9.1-&gt;tsfresh) (1.24.3)
Requirement already satisfied: chardet&lt;4,&gt;=3.0.2 in /usr/local/lib/python3.6/dist-packages (from requests&gt;=2.9.1-&gt;tsfresh) (3.0.4)
Requirement already satisfied: idna&lt;3,&gt;=2.5 in /usr/local/lib/python3.6/dist-packages (from requests&gt;=2.9.1-&gt;tsfresh) (2.10)
Requirement already satisfied: certifi&gt;=2017.4.17 in /usr/local/lib/python3.6/dist-packages (from requests&gt;=2.9.1-&gt;tsfresh) (2020.6.20)
Requirement already satisfied: six in /usr/local/lib/python3.6/dist-packages (from patsy&gt;=0.4.1-&gt;tsfresh) (1.15.0)
Requirement already satisfied: locket in /usr/local/lib/python3.6/dist-packages (from partd&gt;=0.3.10; extra == &quot;dataframe&quot;-&gt;dask[dataframe]&gt;=2.9.0-&gt;tsfresh) (0.2.0)
Requirement already satisfied: immutables&gt;=0.9 in /usr/local/lib/python3.6/dist-packages (from contextvars; python_version &lt; &quot;3.7&quot;-&gt;distributed&gt;=2.11.0-&gt;tsfresh) (0.14)
Requirement already satisfied: heapdict in /usr/local/lib/python3.6/dist-packages (from zict&gt;=0.1.3-&gt;distributed&gt;=2.11.0-&gt;tsfresh) (1.0.1)
</pre></div>
</div>
</div>
</div>
<div class="section" id="prep-the-dataset-for-tsfresh-package">
<h3>Prep the dataset for tsfresh package<a class="headerlink" href="#prep-the-dataset-for-tsfresh-package" title="Permalink to this headline">¶</a></h3>
<p>Typically, the input format options consist of pandas.DataFrame objects. (see <a class="reference external" href="https://tsfresh.readthedocs.io/en/latest/text/large_data.html#large-data-label">Large Input Data</a> for other input types) There are four important column types that make up those DataFrames.</p>
<ol class="simple">
<li><p><em><strong>column_id</strong></em>:</p></li>
</ol>
<blockquote>
<div><p>This column indicates which entities the time series belong to. Features will be extracted individually for each entity (id). The resulting feature matrix will contain one row per id.</p>
</div></blockquote>
<ol class="simple">
<li><p><em><strong>column_sort</strong></em>:</p></li>
</ol>
<blockquote>
<div><p>This column contains values which allow to sort the time series (e.g. time stamps). In general, it is not required to have equidistant time steps or the same time scale for the different ids and/or kinds.</p>
</div></blockquote>
<ol class="simple">
<li><p><em><strong>column_value</strong></em>:</p></li>
</ol>
<blockquote>
<div><p>This column contains the actual values of the time series.</p>
</div></blockquote>
<ol class="simple">
<li><p><em><strong>column_kind</strong></em>:</p></li>
</ol>
<blockquote>
<div><p>This column indicates the names of the different time series types</p>
</div></blockquote>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># make sure our feature df is all numeric before extracting features</span>
<span class="c1"># it should be already but tsfresh was giving errors sometimes</span>

<span class="n">full_set_features2</span> <span class="o">=</span> <span class="n">full_set_features</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">full_set_features2</span> <span class="o">=</span> <span class="n">full_set_features2</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="s2">&quot;time&quot;</span><span class="p">})</span>
<span class="n">full_set_features2</span> <span class="o">=</span> <span class="n">full_set_features2</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">full_set_features2</span><span class="o">.</span><span class="n">head</span><span class="p">(),</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Unpivot a DataFrame from wide to long format, optionally leaving identifiers set.</span>

<span class="c1"># This function is useful to massage a DataFrame into a format where one or more </span>
<span class="c1"># columns are identifier variables (id_vars), while all other columns, considered </span>
<span class="c1"># measured variables (value_vars), are “unpivoted” to the row axis, </span>
<span class="c1"># leaving just two non-identifier columns, ‘variable’ and ‘value’.</span>

<span class="n">full_set_features2</span><span class="p">[</span><span class="s1">&#39;combine_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">full_set_features2</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">full_set_features2</span><span class="o">.</span><span class="n">time</span><span class="p">))</span>
<span class="n">full_set_features2</span> <span class="o">=</span> <span class="n">full_set_features2</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="s2">&quot;id&quot;</span><span class="p">)</span>
<span class="n">melted_features</span> <span class="o">=</span> <span class="n">full_set_features2</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">id_vars</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;combine_id&quot;</span><span class="p">,</span> <span class="s2">&quot;time&quot;</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">melted_features</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">melted_features</span><span class="o">.</span><span class="n">dtypes</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>    time         x         y         z    hr       id
0  870.0 -0.612717 -0.086441 -0.774131  74.5  8692923
1  900.0 -0.608009 -0.078118 -0.779465  66.5  8692923
2  930.0 -0.608291 -0.074685 -0.776802  68.0  8692923
3  960.0 -0.604043 -0.074944 -0.782837  71.0  8692923
4  990.0 -0.607269 -0.070290 -0.782433  68.0  8692923 

                combine_id     time variable      value
0         (8692923, 870.0)    870.0        x  -0.612717
1         (8692923, 900.0)    900.0        x  -0.608009
2         (8692923, 930.0)    930.0        x  -0.608291
3         (8692923, 960.0)    960.0        x  -0.604043
4         (8692923, 990.0)    990.0        x  -0.607269
...                    ...      ...      ...        ...
105663  (3509524, 12360.0)  12360.0       hr  87.000000
105664  (3509524, 12390.0)  12390.0       hr  87.000000
105665  (3509524, 12420.0)  12420.0       hr  87.000000
105666  (3509524, 12450.0)  12450.0       hr  86.500000
105667  (3509524, 12480.0)  12480.0       hr  87.000000

[105668 rows x 4 columns] 
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>combine_id     object
time          float64
variable       object
value         float64
dtype: object
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">full_set_true_labels</span> <span class="o">=</span> <span class="n">full_set_true_labels</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">)</span>
<span class="c1">#full_set_true_labels2 = full_set_true_labels2.reset_index()</span>
<span class="n">full_set_true_labels</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>1</th>
      <th>id</th>
    </tr>
    <tr>
      <th>0</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>870</th>
      <td>0</td>
      <td>8692923</td>
    </tr>
    <tr>
      <th>900</th>
      <td>0</td>
      <td>8692923</td>
    </tr>
    <tr>
      <th>930</th>
      <td>0</td>
      <td>8692923</td>
    </tr>
    <tr>
      <th>960</th>
      <td>0</td>
      <td>8692923</td>
    </tr>
    <tr>
      <th>990</th>
      <td>0</td>
      <td>8692923</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">full_set_true_labels</span><span class="o">.</span><span class="n">dtypes</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1     int64
id    int64
dtype: object
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#new_labels = training_set_true_labels.reset_index(drop=True)</span>
<span class="n">new_labels</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">full_set_true_labels</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="mi">1</span><span class="p">])</span>
<span class="c1">#new_labels = new_labels.reindex(np.arange(0, len(new_labels) + 1, 30))</span>
<span class="n">new_labels</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">full_set_true_labels</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">],</span> <span class="n">full_set_true_labels</span><span class="o">.</span><span class="n">index</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">new_labels</span><span class="o">.</span><span class="n">head</span><span class="p">(),</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">new_labels</span><span class="o">.</span><span class="n">dtypes</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(8692923, 870)    0
(8692923, 900)    0
(8692923, 930)    0
(8692923, 960)    0
(8692923, 990)    0
Name: 1, dtype: int64 
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>dtype(&#39;int64&#39;)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">tsfresh</span> <span class="kn">import</span> <span class="n">extract_features</span>


<span class="c1"># this takes a while ~20mins</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">extract_features</span><span class="p">(</span><span class="n">melted_features</span><span class="p">,</span> <span class="n">column_id</span><span class="o">=</span><span class="s2">&quot;combine_id&quot;</span><span class="p">,</span> <span class="n">column_value</span><span class="o">=</span><span class="s2">&quot;value&quot;</span><span class="p">,</span> <span class="n">column_sort</span><span class="o">=</span><span class="s2">&quot;time&quot;</span><span class="p">)</span>


<span class="nb">print</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/usr/local/lib/python3.6/dist-packages/statsmodels/tools/_testing.py:19: FutureWarning: pandas.util.testing is deprecated. Use the functions in the public API at pandas.testing instead.
  import pandas.util.testing as tm
Feature Extraction: 100%|██████████| 5/5 [29:01&lt;00:00, 348.26s/it]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(26417, 779)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># sort our labels on the index of time step, subject id</span>

<span class="c1"># our original labels</span>
<span class="nb">print</span><span class="p">(</span><span class="n">new_labels</span><span class="o">.</span><span class="n">head</span><span class="p">(),</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># create multiIndex by separating id and time</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_tuples</span><span class="p">(</span><span class="n">new_labels</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;time&#39;</span><span class="p">))</span>

<span class="c1"># reindex our labels using this multiIndex</span>
<span class="n">sorted_new_labels</span> <span class="o">=</span> <span class="n">new_labels</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>


<span class="c1"># sort labels according to this new multiIndex</span>
<span class="n">sorted_new_labels</span><span class="o">.</span><span class="n">sort_index</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">sorted_new_labels</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;/content/drive/My Drive/CA4015/sleep_classify/extracted_features_labels.csv&#39;</span><span class="p">)</span>

<span class="n">sorted_new_labels</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(8692923, 870)    0
(8692923, 900)    0
(8692923, 930)    0
(8692923, 960)    0
(8692923, 990)    0
Name: 1, dtype: int64 
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>id       time 
46343    390      0
         420      0
         450      0
         480      0
         510      0
                 ..
9961348  21450    0
         21480    0
         21510    0
         21540    0
         21570    0
Name: 1, Length: 26417, dtype: int64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Display Extracted Features for each time step of each subject</span>
<span class="nb">print</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                 value__variance_larger_than_standard_deviation  ...  value__permutation_entropy__dimension_7__tau_1
46343   390.0                                               1.0  ...                                             NaN
        420.0                                               1.0  ...                                             NaN
        450.0                                               1.0  ...                                             NaN
        480.0                                               1.0  ...                                             NaN
        510.0                                               1.0  ...                                             NaN
...                                                         ...  ...                                             ...
9961348 21450.0                                             1.0  ...                                             NaN
        21480.0                                             1.0  ...                                             NaN
        21510.0                                             1.0  ...                                             NaN
        21540.0                                             1.0  ...                                             NaN
        21570.0                                             1.0  ...                                             NaN

[26417 rows x 779 columns]
</pre></div>
</div>
</div>
</div>
<p>Drop any features that are NaN / Infinity due to calculations.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">X</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;columns&#39;</span><span class="p">)</span>
<span class="c1"># Check shape of feature</span>
<span class="n">X</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(26417, 270)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isinf</span><span class="p">(</span><span class="n">X</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(array([    0,     1,     2, ..., 26414, 26415, 26416]),
 array([31, 31, 31, ..., 31, 31, 31]))
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">X</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="p">[[</span><span class="mi">31</span><span class="p">]],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> 
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isinf</span><span class="p">(</span><span class="n">X</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(array([], dtype=int64), array([], dtype=int64))
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># save to csv</span>
<span class="n">X</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;/content/drive/My Drive/CA4015/sleep_classify/extracted_features_2.csv&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">tsfresh</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;/content/drive/My Drive/CA4015/sleep_classify/extracted_features_2.csv&#39;</span><span class="p">)</span>
<span class="n">Y</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;/content/drive/My Drive/CA4015/sleep_classify/extracted_features_labels.csv&#39;</span><span class="p">)</span>
<span class="n">y_series</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">Y</span><span class="p">[</span><span class="s1">&#39;1&#39;</span><span class="p">])</span>

</pre></div>
</div>
</div>
</div>
<p>We wanted to see what tsfresh could tell us about some of the more important and significant features it had extracted. So using the relevance function built into tsfresh we created a relevance table and limited it to the top 10 most signficant features. The lower the p_value the more significant the feature.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tsfresh</span><span class="o">.</span><span class="n">feature_selection</span><span class="o">.</span><span class="n">relevance</span><span class="o">.</span><span class="n">calculate_relevance_table</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y_series</span><span class="p">,</span> <span class="n">ml_task</span><span class="o">=</span><span class="s1">&#39;classification&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>feature</th>
      <th>type</th>
      <th>p_value</th>
      <th>relevant</th>
    </tr>
    <tr>
      <th>feature</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Unnamed: 1</th>
      <td>Unnamed: 1</td>
      <td>real</td>
      <td>0.000000e+00</td>
      <td>True</td>
    </tr>
    <tr>
      <th>value__mean_second_derivative_central</th>
      <td>value__mean_second_derivative_central</td>
      <td>real</td>
      <td>1.931131e-132</td>
      <td>True</td>
    </tr>
    <tr>
      <th>value__sum_values</th>
      <td>value__sum_values</td>
      <td>real</td>
      <td>1.977369e-123</td>
      <td>True</td>
    </tr>
    <tr>
      <th>value__mean</th>
      <td>value__mean</td>
      <td>real</td>
      <td>1.977369e-123</td>
      <td>True</td>
    </tr>
    <tr>
      <th>value__fft_coefficient__attr_"real"__coeff_0</th>
      <td>value__fft_coefficient__attr_"real"__coeff_0</td>
      <td>real</td>
      <td>1.977407e-123</td>
      <td>True</td>
    </tr>
    <tr>
      <th>value__fft_coefficient__attr_"abs"__coeff_0</th>
      <td>value__fft_coefficient__attr_"abs"__coeff_0</td>
      <td>real</td>
      <td>1.977407e-123</td>
      <td>True</td>
    </tr>
    <tr>
      <th>value__cwt_coefficients__coeff_2__w_20__widths_(2, 5, 10, 20)</th>
      <td>value__cwt_coefficients__coeff_2__w_20__widths...</td>
      <td>real</td>
      <td>2.075900e-123</td>
      <td>True</td>
    </tr>
    <tr>
      <th>value__cwt_coefficients__coeff_2__w_10__widths_(2, 5, 10, 20)</th>
      <td>value__cwt_coefficients__coeff_2__w_10__widths...</td>
      <td>real</td>
      <td>2.667607e-123</td>
      <td>True</td>
    </tr>
    <tr>
      <th>value__absolute_sum_of_changes</th>
      <td>value__absolute_sum_of_changes</td>
      <td>real</td>
      <td>3.061835e-126</td>
      <td>True</td>
    </tr>
    <tr>
      <th>value__change_quantiles__f_agg_"mean"__isabs_True__qh_1.0__ql_0.0</th>
      <td>value__change_quantiles__f_agg_"mean"__isabs_T...</td>
      <td>real</td>
      <td>3.061953e-126</td>
      <td>True</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>These features and what they actually mean are far from self explanatory, so we referred to the tsfresh documentation to get some descriptions:</p>
<p>Note that in each of these, if there is a formula shown, “x” is the time series we are extracting the features from</p>
<p><strong>Mean second derivative central</strong></p>
<p>This is the mean value of a central approximation of the second derivative</p>
<p><img alt="2b5ee44fd4bec18894fd0d0ca6527f35c5eae087.png" src="_images/2b5ee44fd4bec18894fd0d0ca6527f35c5eae087.png" /></p>
<p><strong>Sum values</strong></p>
<p>Calculates the sum over the time series values</p>
<p><strong>Mean</strong></p>
<p>This is simply the mean of the values in the row</p>
<p><strong>Fft coefficient attr “real”</strong></p>
<p>Calculates the fourier coefficients of the one-dimensional discrete Fourier Transform for real input by fast fourier transformation algorithm. In this case it returns the real value.</p>
<p><img alt="fft_coeff.png" src="_images/fft_coeff.png" /></p>
<p><strong>Fft coefficient attr “abs”</strong></p>
<p>Calculates the fourier coefficients of the one-dimensional discrete Fourier Transform for real input by fast fourier transformation algorithm. In this case it returns the absolute value.</p>
<p><img alt="fft_coeff.png" src="_images/fft_coeff.png" /></p>
<p><strong>Cwt coefficients w20 widths(2, 5, 10, 20)</strong></p>
<p>Calculates a Continuous wavelet transform for the Ricker wavelet, also known as the “Mexican hat wavelet” which is defined by</p>
<p><img alt="cwt_coeff.png" src="_images/cwt_coeff.png" /></p>
<p>where a is the width parameter of the wavelet function.</p>
<p>w is 20 in this feature.</p>
<p>This feature calculator takes three different parameter: widths, coeff and w. The feature calculater takes all the different widths arrays and then calculates the cwt one time for each different width array. Then the values for the different coefficient for coeff and width w are returned. (For each dic in param one feature is returned)</p>
<p><strong>Cwt coefficients w10 widths(2, 5, 10, 20)</strong></p>
<p>Calculates a Continuous wavelet transform for the Ricker wavelet, also known as the “Mexican hat wavelet” which is defined by</p>
<p><img alt="cwt_coeff.png" src="_images/cwt_coeff.png" /></p>
<p>where a is the width parameter of the wavelet function.</p>
<p>w is 10 in this feature.</p>
<p>This feature calculator takes three different parameter: widths, coeff and w. The feature calculater takes all the different widths arrays and then calculates the cwt one time for each different width array. Then the values for the different coefficient for coeff and width w are returned. (For each dic in param one feature is returned)</p>
<p><strong>Absolute sum of changes</strong></p>
<p>Returns the sum over the absolute value of consecutive changes in the series x</p>
<p><img alt="abs_sum.png" src="_images/abs_sum.png" /></p>
<p><strong>Change quantiles</strong></p>
<p>First fixes a corridor given by the quantiles ql and qh of the distribution of x. Then calculates the average, absolute value of consecutive changes of the series x inside this corridor.</p>
<p>Think about selecting a corridor on the y-Axis and only calculating the mean of the absolute change of the time series inside this corridor.</p>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        </div>
    </div>
    
    
    <div class='prev-next-bottom'>
        

    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By The Jupyter Book community<br/>
        
            &copy; Copyright 2020.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    
  <script src="_static/js/index.3da636dd464baa7582d2.js"></script>


    
  </body>
</html>